#!/bin/bash

# --- 配置 ---
# set -e: 如果任何命令失败（返回非零退出码），则立即退出脚本。
# 这可以防止后续阶段在错误的输入上运行。
set -e

./setup > /dev/null

# --- 检查参数 ---
if [ -z "$1" ]; then
    echo "用法: $0 <输入文件.cl>" >&2
    exit 1
fi

./lexer $* | ./parser $* | ./semant $* | ./cgen $*

echo -e "\n\n=== 代码生成输出 ==="
spim ${1/.cl/.s}


# --- 结束 ---
echo -e "\n\n=== 编译流程结束 ==="
